#!/bin/bash
# Post-merge hook for Agora
# Regenerates OpenAPI client if spec changed

set -e

# Check if OpenAPI spec changed
if git diff HEAD@{1} --name-only 2>/dev/null | grep -q "OpenAPI/agora.yaml"; then
    echo "ðŸ“¡ OpenAPI spec changed, regenerating client..."
    
    if command -v agctl &> /dev/null; then
        agctl generate openapi || {
            echo "âš ï¸  Failed to regenerate OpenAPI client"
            echo "Run 'agctl generate openapi' manually"
        }
    else
        echo "âš ï¸  agctl not found"
        echo "Install with: cd Tools/agctl && swift build -c release"
    fi
fi

# Check if Package.swift changed
if git diff HEAD@{1} --name-only 2>/dev/null | grep -q "Package.swift"; then
    echo "ðŸ“¦ Package.swift changed, you may need to rebuild"
fi

